<Window x:Class="FishBrowser.WPF.Views.GpuPickerDialog"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="选择 GPU 配置" Height="500" Width="700"
        WindowStartupLocation="CenterOwner" ResizeMode="CanResize">
  <Grid Margin="10">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>

    <!-- 搜索框 -->
    <StackPanel Grid.Row="0" Margin="0,0,0,8">
      <TextBlock Text="搜索 (Vendor/Renderer):" Margin="0,0,0,4"/>
      <TextBox x:Name="SearchBox" Height="28" TextChanged="SearchBox_TextChanged" Padding="6,4"/>
    </StackPanel>

    <!-- 筛选器 -->
    <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,8">
      <TextBlock Text="OS:" VerticalAlignment="Center" Margin="0,0,8,0"/>
      <ComboBox x:Name="OsFilterCombo" Width="120" Height="26" SelectionChanged="Filter_Changed" VerticalAlignment="Center">
        <ComboBoxItem Content="全部" Tag="" IsSelected="True"/>
        <ComboBoxItem Content="Windows" Tag="Windows"/>
        <ComboBoxItem Content="macOS" Tag="macOS"/>
        <ComboBoxItem Content="Linux" Tag="Linux"/>
        <ComboBoxItem Content="Android" Tag="Android"/>
        <ComboBoxItem Content="iOS" Tag="iOS"/>
      </ComboBox>
      
      <TextBlock Text="Backend:" VerticalAlignment="Center" Margin="16,0,8,0"/>
      <ComboBox x:Name="BackendFilterCombo" Width="140" Height="26" SelectionChanged="Filter_Changed" VerticalAlignment="Center">
        <ComboBoxItem Content="全部" Tag="" IsSelected="True"/>
        <ComboBoxItem Content="ANGLE-D3D11" Tag="ANGLE-D3D11"/>
        <ComboBoxItem Content="OpenGL" Tag="OpenGL"/>
        <ComboBoxItem Content="Vulkan" Tag="Vulkan"/>
        <ComboBoxItem Content="Metal" Tag="Metal"/>
      </ComboBox>

      <Button Content="换一换" Width="80" Height="26" Margin="16,0,0,0" Click="Shuffle_Click"/>
    </StackPanel>

    <!-- GPU 列表（虚拟化） -->
    <ListBox x:Name="GpuList" Grid.Row="2" Margin="0,0,0,8" 
             VirtualizingPanel.IsVirtualizing="True"
             VirtualizingPanel.VirtualizationMode="Recycling">
      <ListBox.ItemTemplate>
        <DataTemplate>
          <StackPanel Orientation="Horizontal" Margin="4">
            <CheckBox x:Name="SelectCheckBox" VerticalAlignment="Center" Margin="0,0,8,0" 
                      IsChecked="{Binding IsSelected, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
            <StackPanel VerticalAlignment="Center">
              <TextBlock Text="{Binding Vendor}" FontWeight="Bold" FontSize="12"/>
              <TextBlock Text="{Binding Renderer}" FontSize="11" Foreground="#666"/>
              <TextBlock Text="{Binding Backend}" FontSize="10" Foreground="#999" Margin="0,2,0,0"/>
            </StackPanel>
          </StackPanel>
        </DataTemplate>
      </ListBox.ItemTemplate>
    </ListBox>

    <!-- 状态与计数 -->
    <StackPanel Grid.Row="2" VerticalAlignment="Bottom" Margin="0,0,0,8" Background="White">
      <Border Padding="6">
        <TextBlock x:Name="CountText" Text="已选: 0 / 显示: 0 / 总计: 0" FontSize="11" Foreground="#666"/>
      </Border>
    </StackPanel>

    <!-- 底部按钮 -->
    <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Right">
      <Button Content="确定" Width="80" Height="28" Click="OK_Click" Margin="0,0,8,0"/>
      <Button Content="取消" Width="80" Height="28" Click="Cancel_Click"/>
    </StackPanel>
  </Grid>
</Window>
